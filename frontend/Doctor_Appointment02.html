<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Appointment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h1 {
            padding-left: 50px;
        }
        .big-container {
            width: 80%;
            margin: 0 auto 25px;
            border: 2px solid #d3d3d3;
            border-radius: 10px;
            padding: 20px;
        }

        .appointment-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .appointment-container label {
            font-weight: bold;
        }

        .appointment-container .row {
            display: flex;
            gap: 10px;
        }

        .appointment-container .column {
            flex: 1;
            padding: 5px;
        }

        .appointment-container input[type="text"],
        .appointment-container input[type="tel"],
        .appointment-container input[type="email"] {
            width: 95%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .appointment-container input[type="radio"] {
            margin: 5px;
        }

        .appointment-container select{
            width: 99%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .appointment-container button {
            padding: 10px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100px;
            margin: auto 10px;
        }

        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .appointment-container button.submit, .appointment-container button.clear, .appointment-container button.back {
            background-color: #CA1F7B; 
            color: white;
        }

        .appointment-container button.submit:hover, .appointment-container button.clear:hover, .appointment-container button.back:hover {
            background-color: #8E004A; 
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        caption {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .available {
            background-color: #4e9ea7;
            cursor: pointer;
        }
        .available:hover {
            background-color: #027382;
        }
        .unavailable {
            background-color: #8E004A;
        }
        
        tr{
            height:15px;
        }
    </style>
</head>
<body>
    <div id="headerContainer"></div>

    <h1>Create Appointment</h1>
    <div class="big-container">
    <div class="appointment-container">
        <form id="appointmentForm">
            <div class="row">
                <div class="column">
                    <label for="patientID">Patient ID:</label>
                    <input type="text" id="patientID" name="patientID" required>
                </div>
                <div class="column">
                    <label for="patientName">Patient Name:</label>
                    <input type="text" id="patientName" name="patientName" disabled>
                </div>
            </div>
            <br>
            <table id="availabilityTable">
                <caption>Doctor's Availability</caption>
                <tr>
                    <th scope="col">Time</th>
                    <th scope="col">Time Slot</th>
                    <!-- Weekday columns will be dynamically generated -->
                </tr>
                <!-- Time slots from 8am to 11am -->
                <tr>
                    <th rowspan="3" scope="rowgroup">8am</th>
                    <td>8:00-8:20</td>
                    <!-- Morning session availability will be dynamically generated -->
                </tr>
                <tr>
                    <td>8:20-8:40</td>
                    <!-- Morning session availability will be dynamically generated -->
                </tr>
                <tr>
                    <td>8:40-9:00</td>
                    <!-- Morning session availability will be dynamically generated -->
                </tr>
                <!-- Additional time slots for the morning session -->
                <!-- Dynamically generated time slots for the morning session -->
                <tr>
                    <th rowspan="3" scope="rowgroup">9am</th>
                    <td>9:00-9:20</td>
                </tr>
                <tr>
                    <td>9:20-9:40</td>
                </tr>
                <tr>
                    <td>9:40-10:00</td>
                </tr>
                <!-- Dynamically generated time slots for the morning session -->
                <tr>
                    <th rowspan="3" scope="rowgroup">10am</th>
                    <td>10:00-10:20</td>
                </tr>
                <tr>
                    <td>10:20-10:40</td>
                </tr>
                <tr>
                    <td>10:40-11:00</td>
                </tr>
                <!-- Dynamically generated time slots for the morning session -->
                <tr>
                    <th rowspan="3" scope="rowgroup">11am</th>
                    <td>11:00-11:20</td>
                </tr>
                <tr>
                    <td>11:20-11:40</td>
                </tr>
                <tr>
                    <td>11:40-12:00</td>
                </tr>
                <!-- Time slots from 2pm to 5pm -->
                <tr>
                    <th rowspan="3" scope="rowgroup">2pm</th>
                    <td>14:00-14:20</td>
                    <!-- Afternoon session availability will be dynamically generated -->
                </tr>
                <tr>
                    <td>14:20-14:40</td>
                    <!-- Afternoon session availability will be dynamically generated -->
                </tr>
                <tr>
                    <td>14:40-15:00</td>
                    <!-- Afternoon session availability will be dynamically generated -->
                </tr>
                <!-- Additional time slots for the afternoon session -->
                <!-- Dynamically generated time slots for the afternoon session -->
                <tr>
                    <th rowspan="3" scope="rowgroup">3pm</th>
                    <td>15:00-15:20</td>
                </tr>
                <tr>
                    <td>15:20-15:40</td>
                </tr>
                <tr>
                    <td>15:40-16:00</td>
                </tr>
                <!-- Dynamically generated time slots for the afternoon session -->
                <tr>
                    <th rowspan="3" scope="rowgroup">4pm</th>
                    <td>16:00-16:20</td>
                </tr>
                <tr>
                    <td>16:20-16:40</td>
                </tr>
                <tr>
                    <td>16:40-17:00</td>
                </tr>
                <!-- Dynamically generated time slots for the afternoon session -->
                <tr>
                    <th rowspan="3" scope="rowgroup">5pm</th>
                    <td>17:00-17:20</td>
                </tr>
                <tr>
                    <td>17:20-17:40</td>
                </tr>
                <tr>
                    <td>17:40-18:00</td>
                </tr>
            </table>
        


            <div class="button-container"> 
                <button type="button" class="clear">Clear</button>
                <button type="submit" class="submit">Submit</button>
            </div>
        </form>
    </div>
    </div>
    <div id="footerContainer"></div>

    <script>
        fetch("Doctor_Header.html")
          .then((response) => response.text())
          .then((html) => {
            document.getElementById("headerContainer").innerHTML = html;
          });

        fetch("Footer.html")
        .then((response) => response.text())
        .then((html) => {
          document.getElementById("footerContainer").innerHTML = html;
          document.getElementById("year").textContent = new Date().getFullYear();
        });

        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById("appointmentForm");

            // Clear Button functionality
            const clearButton = document.querySelector(".clear");
            clearButton.addEventListener("click", function() {
                // Clear selected cells
                const selectedCells = document.querySelectorAll('.selected');
                selectedCells.forEach(cell => {
                    cell.classList.remove('selected');
                });
            });

            // Submit Button functionality
            form.addEventListener("submit", function(event) {
                event.preventDefault(); // Prevent default form submission

                // Collect selected date and time (time slot)
                const selectedSlot = document.querySelector('.selected');
                if (!selectedSlot) {
                    alert("Please select a time slot.");
                    return;
                }
                const timeSlot = selectedSlot.textContent.trim();

                // Collect other form data
                const formData = {
                    patientID: document.getElementById("patientID").value,
                    patientName: document.getElementById("patientName").value,
                    timeSlot: timeSlot
                };

                // Send formData to the server using AJAX or fetch API
                fetch('/createAppointment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (response.ok) {
                        // Show success message
                        alert('Appointment created successfully.');
                        // Redirect to Doctor_Appointment01.html after successful submission
                        window.location.href = 'Doctor_Appointment01.html';
                    } else {
                        throw new Error('Failed to submit appointment data.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Handle errors here if necessary
                });
            });
        });
    // Function to generate dates for this week and next week (excluding weekends)
    function generateDates() {
            const today = new Date();
            const dates = [];
            let dayIncrement = 0;

            while (dates.length < 10) {
                const date = new Date(today.getTime() + dayIncrement * 24 * 60 * 60 * 1000);
                const dayOfWeek = date.getDay();

                // Skip Saturday (6) and Sunday (0)
                if (dayOfWeek !== 6 && dayOfWeek !== 0) {
                    const weekday = date.toLocaleDateString('en-US', { weekday: 'short' });
                    const day = date.getDate();
                    const month = date.toLocaleDateString('en-US', { month: 'short' });
                    dates.push(`${weekday}, ${day} ${month}`);
                }

                dayIncrement++;
            }

            return dates;
        }

        // Function to dynamically generate table headers
        function generateTableHeaders() {
            const table = document.getElementById('availabilityTable');
            const dates = generateDates();

            for (let i = 0; i < dates.length; i++) {
                const th = document.createElement('th');
                th.textContent = dates[i];
                table.querySelector('tr').appendChild(th);
            }
        }

        // Function to fetch doctor availability data from the backend
        function fetchDoctorAvailability() {
            fetch('/retrieveDoctorAvailability')
                .then(response => response.json())
                .then(data => {
                    // Process the availability data and update table cells
                    updateTable(data);
                })
                .catch(error => {
                    console.error('Error fetching doctor availability:', error);
                });
        }

        // Function to update table cells based on availability data
        function updateTable(availabilityData) {
            const table = document.getElementById('availabilityTable');
            const rows = table.getElementsByTagName('tr');
            const timeCells = Array.from(rows).slice(1); // Exclude header row

            timeCells.forEach(row => {
                const timeSlot = row.cells[1].textContent.trim(); // Get the time slot
                const availability = availabilityData[timeSlot];
                if (availability === 'available') {
                    row.cells[2].classList.add('available'); // Green background
                } else if (availability === 'unavailable') {
                    row.cells[2].classList.add('unavailable'); // Red background
                }
                // Add event listener for selecting green time slots
                if (availability === 'available') {
                    row.cells[2].classList.add('available'); // Green background
                    row.cells[2].addEventListener('click', () => {
                        // Implement appointment booking logic here
                        console.log('Selected time slot:', timeSlot);
                    });
                } else if (availability === 'unavailable') {
                    row.cells[2].classList.add('unavailable'); // Red background
                    row.cells[2].style.cursor = 'not-allowed'; // Change cursor to not-allowed
                    row.cells[2].removeAttribute('onclick'); // Remove click event listener
                }
            });
        }

        // Call the function to fetch doctor availability when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            fetchDoctorAvailability();
            generateTableHeaders();
        });
</script>


</body>
</html>
